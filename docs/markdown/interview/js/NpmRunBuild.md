# npm run build 做了些什么？

在 Webpack 构建过程中，`npm run build` 命令触发构建后，会依次经历 `make`、`module`、 `graph`、`seal`、`chunk graph` 等关键阶段

## 1. make 阶段

- **含义**：make 阶段也被称为`构建阶段`，是 `Webpack` 开始实际构建模块的起点。在这个阶段，`Webpack` 会从入口文件开始，根据配置文件中指定的`入口`，递归地去解析和加载项目中的所有模块及其依赖关系。

- **作用**：此阶段会识别出项目中所有需要处理的模块，并且开始调用相应的加载器（`Loaders`）对模块进行转换。例如，如果遇到 .css 文件，就会调用 `css-loader` 和 `style-loader` 对其进行处理；遇到 `.jsx` 文件，会调用 `babel-loader` 进行代码转换。

## 2. module graph 阶段

- **含义**：module graph 即`模块图阶段`。在完成 `make` 阶段对模块的解析和加载后，Webpack 会根据模块之间的依赖关系`构建一个模块图`。这个模块图是一个有向图，其中每个节点代表一个模块，每条边代表模块之间的`依赖关系`。
- **作用**：模块图清晰地展示了项目中各个模块之间的依赖结构，Webpack 可以基于这个图来进行后续的优化和处理。例如，根据模块图进行代码分割，将不同的模块打包到不同的文件中，实现按需加载，提高应用的性能。

## 3. seal 阶段

- **含义**：seal 阶段可以理解为`密封阶段`。在这个阶段，Webpack 会对之前构建好的模块图进行最后的`处理和优化`。它会对模块进行进一步的`分析和转换`，为生成最终的打包文件做准备。
- **作用**：在 seal 阶段，Webpack 会应用各种插件（Plugins）来完成一些额外的任务，如`代码压缩、提取公共模块、生成哈希文件名等`。例如，使用 TerserPlugin 对 JavaScript 代码进行压缩，减小文件体积；使用 MiniCssExtractPlugin 提取 CSS 到单独的文件中。

## 4. chunk graph 阶段

- **含义**：chunk graph 即`代码块图阶段`。在 seal 阶段完成对模块的处理后，Webpack 会根据模块之间的依赖关系和优化策略，将模块分组`打包`成一个个代码块（Chunks），并构建出代码块图。代码块图同样是一个有向图，节点代表代码块，边代表代码块之间的依赖关系。
- **作用**：代码块图决定了最终打包文件的结构和内容。Webpack 会根据代码块图将代码块输出到不同的文件中，实现代码的分割和按需加载。例如，将一些不常用的模块打包成一个单独的代码块，在需要时再进行加载，减少初始加载时间。

综上所述，`make、module graph、seal、chunk graph` 这几个阶段是 Webpack 构建过程中的关键步骤，每个阶段都有其特定的任务和作用，它们共同协作，最终将项目中的所有模块打包成适合生产环境部署的文件。
